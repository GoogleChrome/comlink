function k(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function l(b,d){return d.reduce(function(b,a){return b[a]},b)}function m(b){void 0===b&&(b=128);return Array(b/16).fill(0).map(k).join("")}function n(b,d,c){b=l(b,d.slice(0,-1));d=d[d.length-1];var a=b[d];b[d]=c;return a}
function p(b,d,c){var a=c||{};c=a.path;c=void 0===c?[]:c;a=a.channels;a=void 0===a?[]:a;if(b instanceof d)a.push(c.slice());else if(b instanceof Object)for(var g=0,e=Object.keys(b);g<e.length;g++){var f=e[g];p(b[f],d,{path:c.concat([f]),channels:a})}return a}function q(b,d){var c=new MessageChannel,a=c.port1;t(c.port2,b,d);return a}function u(b,d,c){var a=b.messagePortPaths.map(function(a){var c=l(b.message,a);c=q(d,c);n(b.message,a,c);return c});c.postMessage(b.message,a)}
function t(b,d,c){b.onmessage=function(a){c=c||m();a=a.data;for(var b=c,e=p(a,MessagePort),f=0;f<e.length;f++){var h=e[f],r=m();h=n(a,h,r);t(h,d,r)}a=JSON.stringify({id:b,message:a,messagePortPaths:e});d.send(a)};d.addEventListener("message",function(a){if("data"in a){a:{try{var g=JSON.parse(a.data);var e="id"in g?g:void 0;break a}catch(f){}e=void 0}!e||c&&c!==e.id||u(e,d,b)}})}var wrap=q;export{wrap};
