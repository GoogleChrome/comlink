function h(b,c){void 0===c&&(c=null);var d=new MessageChannel,a=d.port1;k(d.port2,b,c);return a}
function k(b,c,d){void 0===d&&(d=null);b.onmessage=function(a){d||(d=l());var e=a.data;a=Array.from(m(a.data));for(var b=0;b<a.length;b++){var g=a[b],n=l();g=p(e,g,n);k(g,c,n)}e=JSON.stringify({id:d,msg:e,messageChannels:a});c.send(e)};c.addEventListener("message",function(a){var e={};try{e=JSON.parse(a.data)}catch(f){return}d&&d!==e.id||(a=e.messageChannels.map(function(a){var b=a.reduce(function(a,b){return a[b]},e.msg);b=h(c,b);p(e.msg,a,b);return b}),b.postMessage(e.msg,a))})}
function p(b,c,d){for(var a=0,e=c.slice(0,-1);a<e.length;a++)b=b[e[a]];c=c[c.length-1];a=b[c];b[c]=d;return a}function m(b,c,d){void 0===c&&(c=[]);void 0===d&&(d=[]);if(!b||"string"===typeof b)return[];if(b instanceof MessagePort)d.push(c.slice());else for(var a=0,e=Object.keys(b);a<e.length;a++){var f=e[a];c.push(f);m(b[f],c,d);c.pop()}return d}var q=128;function l(){return Array(q/16).fill(0).map(function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}).join("")}
var wrap=h;export{wrap};
