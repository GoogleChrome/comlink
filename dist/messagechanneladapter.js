function h(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function k(a,d){return d.reduce(function(c,b){return c[b]},a)}function l(a){void 0===a&&(a=128);return Array(a/16).fill(0).map(h).join("")}function m(a,d,c){a=k(a,d.slice(0,-1));d=d[d.length-1];var b=a[d];a[d]=c;return b}
function n(a,d,c){var b=c||{};c=b.path;c=void 0===c?[]:c;b=b.channels;b=void 0===b?[]:b;if(a instanceof d)b.push(c.slice());else if(a instanceof Object)for(var e=0,f=Object.keys(a);e<f.length;e++){var g=f[e];n(a[g],d,{path:c.concat([g]),channels:b})}return b}function q(a,d){void 0===d&&(d=null);var c=new MessageChannel,b=c.port1;r(c.port2,a,d);return b}
function r(a,d,c){void 0===c&&(c=null);a.onmessage=function(b){c||(c=l());var a=b.data;b=n(b.data,MessagePort);for(var f=0;f<b.length;f++){var g=b[f],p=l();g=m(a,g,p);r(g,d,p)}a=JSON.stringify({id:c,msg:a,messageChannels:b});d.send(a)};d.addEventListener("message",function(b){var e={};try{e=JSON.parse(b.data)}catch(f){return}c&&c!==e.id||(b=e.messageChannels.map(function(b){var a=b.reduce(function(a,b){return a[b]},e.msg);a=q(d,a);m(e.msg,b,a);return a}),a.postMessage(e.msg,b))})}var wrap=q;export{wrap};
