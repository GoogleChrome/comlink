function g(a,b){return b.reduce(function(a,b){return a[b]},a)}function h(a,b,c){a=g(a,b.slice(0,-1));b=b[b.length-1];var d=a[b];a[b]=c;return d}
function k(a,b){var c=b||{};b=c.path;b=void 0===b?[]:b;var d=c.visited;d=void 0===d?new WeakSet:d;c=c.properties;c=void 0===c?[]:c;if(!a||d.has(a)||"string"===typeof a||ArrayBuffer.isView(a))return[];"object"===typeof a&&d.add(a);c.push({value:a,path:b});for(var e=0,f=Object.keys(a);e<f.length;e++){var q=f[e];k(a[q],{path:b.concat([q]),visited:d,properties:c})}return c}var l=Symbol("proxyValue"),m=Symbol("throw"),n=["ArrayBuffer","MessagePort","OffscreenCanvas"].filter(function(a){return a in self}).map(function(a){return self[a]});
function p(a){return n.some(function(b){return a instanceof b})}function r(a){var b=[],c=0;for(a=k(a);c<a.length;c++){var d=a[c].value;p(d)&&b.push(d)}return b}
var v=new Map([["PROXY",{canHandle:function(a){return a&&a[l]},serialize:function(a){var b=new MessageChannel,c=b.port2;t(a,b.port1);return c},deserialize:function(a){return u(a)}}],["THROW",{canHandle:function(a){return a&&a[m]},serialize:function(a){return Object.assign({},a,{message:a&&a.message,stack:a&&a.stack})},deserialize:function(a){throw Object.assign(Error(),a);}}]]);
function w(a){for(var b=0,c=Array.from(v);b<c.length;b++){var d=c[b],e=d[0];d=d[1];if(d.canHandle(a))return{type:e,value:d.serialize(a)}}}function x(a){if(v.has(a.type))return v.get(a.type).deserialize(a.value)}function y(a){var b=w(a);if(b)return b;b=[];for(var c=0,d=k(a);c<d.length;c++){var e=d[c],f=w(e.value);f&&(h(a,e.path,null),b.push({path:e.path,wrappedValue:f}))}return{type:"RAW",value:a,wrappedChildren:b}}
function z(a){var b=x(a);if(b)return b;if("RAW"!==a.type)throw Error('Unknown value type "'+a.type+'"');b=0;for(var c=a.wrappedChildren||[];b<c.length;b++){var d=c[b],e=x(d.wrappedValue);if(!e)throw Error('Unknown value type "'+a.type+'" at '+d.path.join("."));h(a.value,d.path,e)}return a.value}function A(a){return["window","length","location","parent","opener"].every(function(b){return b in a})}
function B(a){if("Window"!==self.constructor.name)throw Error("self is not a window");return{addEventListener:self.addEventListener.bind(self),removeEventListener:self.removeEventListener.bind(self),postMessage:function(b,c){return a.postMessage(b,"*",c)}}}function C(a){A(a)&&(a=B(a));if(!("addEventListener"in a&&"removeEventListener"in a&&"postMessage"in a))throw Error("endpoint does not have all of addEventListener, removeEventListener and postMessage defined");return a}
function D(a){"MessagePort"===a.constructor.name&&a.start()}var E=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER),F=0;function G(a,b){a.addEventListener("message",b)}function H(a,b){return new Promise(function(c){G(a,function K(b){b.data.id===d&&(a.removeEventListener("message",K),c(b.data))});var d=E+"-"+F++;b=Object.assign({},b,{id:d});var e="argumentsList"in b?r(b.argumentsList):[];a.postMessage(b,e)})}
function I(a,b){var c=g(a,b.callPath.slice(0,-1));a=g(a,b.callPath);return Promise.all([c,a]).then(function(a){var c=a[0];a=a[1];switch(b.type){case "CONSTRUCT":return c=b.argumentsList.map(z),c=new (a.bind.apply(a,[void 0].concat(c))),J(c);case "APPLY":var d=b.argumentsList.map(z);return a.apply(c,d);case "GET":return a;case "SET":return a[b.property]=b.value,!0}}).catch(function(a){a[m]=!0;return a}).then(function(a){var c=b.id,d=w(a);a=d?{id:c,value:d}:{id:c,value:{type:"RAW",value:a}};return a})}
function L(a,b,c){void 0===a&&(a=function(){});void 0===c&&(c=[]);return new Proxy(a,{construct:function(a,e){a={type:"CONSTRUCT",callPath:c,argumentsList:e.map(y)};return b(a)},apply:function(a,e,f){if("bind"===c[c.length-1])return L(function(){},b,c.slice(0,-1));a={type:"APPLY",callPath:c,argumentsList:f.map(y)};return b(a)},get:function(d,e,f){if("then"===e&&0===c.length)return{then:function(){return f}};if("then"!==e)return L(a[e],b,c.concat([e]));d=b({type:"GET",callPath:c});return Promise.resolve(d).then.bind(d)},
set:function(a,e,f){return b({type:"SET",callPath:c,property:e,value:f})}})}function u(a,b){var c=C(a);D(c);return L(b,function(a){return H(c,a).then(function(a){return z(a.value)})})}function J(a){a[l]=!0;return a}function t(a,b){var c=C(b);D(c);G(c,function(b){"id"in b.data&&"callPath"in b.data&&I(a,b.data).then(function(a){c.postMessage(a,r([a]))})})}var proxy=u;var proxyValue=J;var expose=t;export{proxy,proxyValue,expose};
