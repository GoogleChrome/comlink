'use strict';(function(g,e){"object"===typeof exports&&"undefined"!==typeof module?e(exports):"function"===typeof define&&define.amd?define(["exports"],e):e(g.messagechanneladapter={})})(this,function(g){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function l(b,d){return d.reduce(function(b,a){return b[a]},b)}function m(b){void 0===b&&(b=128);return Array(b/16).fill(0).map(e).join("")}function n(b,d,c){b=l(b,d.slice(0,-1));d=d[d.length-1];var a=b[d];b[d]=c;return a}
function p(b,d,c){var a=c||{};c=a.path;c=void 0===c?[]:c;a=a.channels;a=void 0===a?[]:a;if(b instanceof d)a.push(c.slice());else if(b instanceof Object)for(var k=0,f=Object.keys(b);k<f.length;k++){var h=f[k];p(b[h],d,{path:c.concat([h]),channels:a})}return a}function q(b,d){var c=new MessageChannel,a=c.port1;r(c.port2,b,d);return a}function t(b,d,c){var a=b.messagePortPaths.map(function(a){var c=l(b.message,a);c=q(d,c);n(b.message,a,c);return c});c.postMessage(b.message,a)}function r(b,d,c){b.onmessage=
function(a){c=c||m();a=a.data;for(var b=c,f=p(a,MessagePort),h=0;h<f.length;h++){var e=f[h],g=m();e=n(a,e,g);r(e,d,g)}a=JSON.stringify({id:b,message:a,messagePortPaths:f});d.send(a)};d.addEventListener("message",function(a){if("data"in a){a:{try{var e=JSON.parse(a.data);var f="id"in e?e:void 0;break a}catch(h){}f=void 0}!f||c&&c!==f.id||t(f,d,b)}})}g.wrap=q;Object.defineProperty(g,"__esModule",{value:!0})});
